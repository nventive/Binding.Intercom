parameters:
- name: pathToSrc
  type: string
  default: '$(Build.SourcesDirectory)'

steps:
- task: NuGetToolInstaller@0

- task: UseDotNet@2
  displayName: 'Install .NET SDK'
  inputs:
    packageType: 'sdk'
    version: '7.0.403'

- script: >
    dotnet $(dotNetCommand) ${{ parameters.pathToSrc }}/Binding.Intercom.Twig
    -f:$(BuildTargetFramework)
    -c:Release
    /p:InformationalVersion=$(GitVersion.InformationalVersion)
    /bl:$(build.artifactstagingdirectory)/build-$(BuildTargetFramework).binlog
  displayName: Build Project for Release

- task: CopyFiles@2
  displayName: 'Copy Binary Files'
  retryCountOnTaskFailure: 3
  inputs:
    SourceFolder: '${{ parameters.pathToSrc }}/Binding.Intercom.Twig/bin/Release/net7.0-android'
    Contents: |
      **/*.*
    TargetFolder: $(build.ArtifactStagingDirectory)
    CleanTargetFolder: false
    OverWrite: true
    flattenFolders: true

- publish: $(Build.ArtifactStagingDirectory)
  artifact: $(ArtifactName)

- task: PostBuildCleanup@3
  displayName: 'Post-Build Cleanup: Cleanup files to keep build server clean!'
  condition: always()