parameters:
- name: pathToSrc
  type: string
  default: '$(Build.SourcesDirectory)'

steps:
- task: UseDotNet@2
  displayName: 'Install .NET SDK'
  inputs:
    packageType: 'sdk'
    version: '7.0.403'

- powershell: dotnet workload install maui --source https://aka.ms/dotnet6/nuget/index.json --source https://api.nuget.org/v3/index.json
  displayName: Install .NET MAUI Workload

- task: NuGetAuthenticate@1
  inputs:
    forceReinstallCredentialProvider: true

- script: >
    dotnet pack ${{ parameters.pathToSrc }}/Binding.Intercom.Xamarin
    -c:Release
    /bl:$(build.artifactstagingdirectory)/build-$(BuildTargetFramework).binlog
  displayName: Build Project for Release

- task: CopyFiles@2
  displayName: 'Copy Nuget packages'
  retryCountOnTaskFailure: 3
  inputs:
    SourceFolder: '${{ parameters.pathToSrc }}'
    Contents: |
      **/*.nupkg
    TargetFolder: $(build.ArtifactStagingDirectory)
    CleanTargetFolder: false
    OverWrite: true
    flattenFolders: true

- publish: $(Build.ArtifactStagingDirectory)
  artifact: $(ArtifactName)